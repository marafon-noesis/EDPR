<!DOCTYPE html>

<html lang="en" xmlns="www.w3.org/.../xhtml&quot;>

<head>
    <meta charset="utf-8" />
    <title>Empty Offline HTML page</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1, user-scalable=no" />
    <script src="../JSBridge.js"></script>
</head>

<body onload="onLoad()">

    <script>

        function onLoad() {

            //MobileCRM.UI.EntityForm.requestObject(

            //    function (entityForm) {
            //        var workOrderProduct = entityForm.entity;
            //        if (workOrderProduct.isNew) {
            //           // MobileCRM.bridge.alert("alert ");

            //            //MobileCRM.UI.EntityForm.requestObject(function (entityForm) {
            //                var d = new Date();
            //                entityForm.entity.properties["edprdyn_documentyear"] = d.getFullYear();

            //            //}, function (err) {
            //            //   MobileCRM.bridge.alert("An error occurred: " + err);
            //            //}, null);
            //        }
            //    },
            //    function (err) {
            //        MobileCRM.bridge.alert("An error occurred: " + err);
            //    },
            //    null
            //);


            try {

                MobileCRM.UI.EntityForm.onCommand("custom_sendSAP",
                    function (entityForm) {
                        if (entityForm)
                            MobileCRM.UI.EntityForm.saveAndClose();
                    }
                );
            }
            catch (e) {
                throw new MobileCrmException("custom_sendSAP" + e.message);
            }

            try {

                MobileCRM.UI.EntityForm.onCommand("custom_onCancel",
                    function (entityForm) {
                        if (entityForm)
                            MobileCRM.UI.EntityForm.saveAndClose();
                    }
                );
            }
            catch (e) {
                throw new MobileCrmException("custom_onCancel" + e.message);
            }

            //https://www.resco.net/blog/how-to-set-up-save-button-actions-in-resco-mobile-crm/
            try {

                MobileCRM.UI.EntityForm.onCommand("custom_forcesave",                    
                    function (entityForm) {
                        MobileCRM.bridge.alert("custom_forcesave");
                        if (entityForm) {
                            //isNew	Boolean	Indicates whether the entity is newly created.
                            var goodsReceipt = entityForm.entity;

                            var c_goodsReceipt = goodsReceipt;
                            c_goodsReceipt.save(
                                function (error) {
                                    if (error)
                                        MobileCRM.bridge.alert("An error occurred: " + error);
                                    else {
                                        // callback is called in scope of newly created MobileCRM.DynamicEntity object; thus we can access the data using "this" keyword
                                        var newId = this.id;
                                        var allProps = this.properties;
                                        rememberNewAccount(newId, allProps.name);
                                        MobileCRM.bridge.alert("Creado");
                                    }
                                }
                                , true);

                        }
                        //    MobileCRM.UI.EntityForm.saveAndClose();
                    }
                );
            }
            catch (e) {
                throw new MobileCrmException("custom_forcesave" + e.message);
            }
        }



    </script>

</body>

</html>